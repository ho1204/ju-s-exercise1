<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>득근 캘린더</title>
    
    <!-- PWA 및 모바일 앱 설정 (주소창 없애기) --><meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="득근 캘린더">
    <meta name="theme-color" content="#4f46e5"> <!-- 인디고 색상 --><meta name="mobile-web-app-capable" content="yes">

    <!-- Tailwind CSS 불러오기 --><script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM 불러오기 --><script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel (JSX 변환용) 불러오기 --><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            -webkit-tap-highlight-color: transparent; /* 모바일 터치 하이라이트 제거 */
            overscroll-behavior-y: none; /* 스크롤 팅김 방지 */
        }
        /* 애니메이션 효과 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        /* 아이폰 노치 영역 대응 */
        body {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 select-none"> <!-- 텍스트 선택 방지 --><div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 아이콘 컴포넌트 ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Calendar = (props) => (
            <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></IconBase>
        );
        const Clock = (props) => (
            <IconBase {...props}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></IconBase>
        );
        const Dumbbell = (props) => (
            <IconBase {...props}><path d="M6.5 6.5h11" /><path d="M6.5 17.5h11" /><path d="m2 21 20-20" /><path d="M5 5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2" /><path d="M19 5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2" /></IconBase>
        );
        const Plus = (props) => (
            <IconBase {...props}><path d="M5 12h14" /><path d="M12 5v14" /></IconBase>
        );
        const Trash2 = (props) => (
            <IconBase {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></IconBase>
        );
        const Activity = (props) => (
            <IconBase {...props}><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></IconBase>
        );
        const CheckCircle2 = (props) => (
            <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="m9 12 2 2 4-4" /></IconBase>
        );
        const ChevronRight = (props) => (
            <IconBase {...props}><path d="m9 18 6-6-6-6" /></IconBase>
        );

        // --- 메인 App 컴포넌트 ---
        const App = () => {
            const [workouts, setWorkouts] = useState([]);
            const [date, setDate] = useState('');
            const [duration, setDuration] = useState(30);
            const [selectedParts, setSelectedParts] = useState([]);
            const [selectedDetails, setSelectedDetails] = useState([]);

            // 운동 부위 목록 (상체, 하체로 변경)
            const BODY_PARTS = ['상체', '하체'];

            // 상체 세부 운동 목록 (유사한 동작끼리 정리)
            // 순서: 가슴 -> 등 -> 복합 -> 어깨
            const UPPER_EXERCISES = [
                // 가슴 (Chest)
                '벤치프레스', '플랫 벤치 프레스', '인클라인 벤치프레스', '뎀벨프레스', '체스트 프레스', '푸쉬업', '풀오버', 
                // 등 (Back)
                '풀업', '렛풀다운', '언더 그립 렛풀다운', '맥그립 렛풀다운', '시티드 로우', '뎀벨로우', 
                // 복합 (Compound/Full Body)
                '데드리프트', '루마니안 데드리프트',
                // 어깨 (Shoulder)
                '오버헤드 프레스', '바벨 숄더 프레스', '뎀벨숄더프레스', '사이드 레터널 레이즈', '벤트 오브 레터널 레이즈', '페이스 풀', '와이레이즈', '외회전 운동'
            ];

            // 하체 세부 운동 목록 (유사한 동작끼리 정리)
            // 순서: 복합 -> 편측/균형 -> 고립/머신 -> 후면/보조
            const LOWER_EXERCISES = [
                // 복합 (Compound)
                '바벨스쿼트', '백 스쿼트', '고블릿 스쿼트', '스미스 머신 스쿼트', '스쿼트', '파워 레그 프레스', '힙스러스트', '힙 브릿지', '스미스 머신 데드리프트',
                // 편측/균ilateral)
                '워킹 런지', '백 런지', '스플릿 스쿼트', '불가리안 스플릿 스쿼트', 
                // 고립/머신 (Isolation/Machine)
                '레그 익스텐션', '레그컬', '내전근 운동', '스탠딩 아웃 타이',
                // 후면/보조 (Posterior/Assistance)
                '굿모닝 스쿼트'
            ];
            
            const DURATION_OPTIONS = [30, 60, 90, 120, 150, 180];

            useEffect(() => {
                const savedWorkouts = localStorage.getItem('myWorkouts');
                if (savedWorkouts) setWorkouts(JSON.parse(savedWorkouts));
                const today = new Date().toISOString().split('T')[0];
                setDate(today);
            }, []);

            useEffect(() => {
                localStorage.setItem('myWorkouts', JSON.stringify(workouts));
            }, [workouts]);

            const toggleBodyPart = (part) => {
                if (selectedParts.includes(part)) {
                    const newParts = selectedParts.filter(p => p !== part);
                    setSelectedParts(newParts);
                    
                    // 해당 부위의 세부 항목만 selectedDetails에서 제거
                    let exercisesToRemove = [];
                    if (part === '상체') {
                        exercisesToRemove = UPPER_EXERCISES;
                    } else if (part === '하체') {
                        exercisesToRemove = LOWER_EXERCISES;
                    }

                    const detailsToKeep = selectedDetails.filter(detail => !exercisesToRemove.includes(detail));
                    setSelectedDetails(detailsToKeep);

                } else {
                    setSelectedParts([...selectedParts, part]);
                }
            };

            const toggleDetail = (exercise, exerciseList) => {
                if (selectedDetails.includes(exercise)) {
                    // 선택 해제
                    setSelectedDetails(selectedDetails.filter(e => e !== exercise));
                } else {
                    // 선택 (기존 목록에 추가)
                    setSelectedDetails([...selectedDetails, exercise]);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (selectedParts.length === 0) {
                    // NOTE: window.alert() 대신 Custom Modal UI를 사용해야 하지만, 
                    // 단일 HTML 파일의 단순성 유지 및 Canvas 환경 지침을 위해 임시로 console.error 사용
                    console.error("최소 한 개의 운동 부위를 선택해주세요.");
                    return;
                }
                const newWorkout = {
                    id: Date.now(),
                    date,
                    duration,
                    parts: selectedParts,
                    details: selectedDetails,
                    createdAt: new Date().toISOString()
                };
                setWorkouts([newWorkout, ...workouts]);
                setSelectedParts([]);
                setSelectedDetails([]);
                setDuration(30);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const deleteWorkout = (id) => {
                // NOTE: window.confirm() 대신 Custom Modal UI를 사용해야 함
                if (window.confirm('이 기록을 삭제하시겠습니까?')) {
                    setWorkouts(workouts.filter(w => w.id !== id));
                }
            };

            const formatDuration = (mins) => {
                const hours = Math.floor(mins / 60);
                const minutes = mins % 60;
                if (hours > 0 && minutes > 0) return `${hours}시간 ${minutes}분`;
                if (hours > 0) return `${hours}시간`;
                return `${minutes}분`;
            };

            const totalSessions = workouts.length;
            const totalMinutes = workouts.reduce((acc, curr) => acc + parseInt(curr.duration), 0);

            // 세부 운동 목록 렌더링 함수
            const DetailSelector = ({ partName, exercises, title }) => (
                <div className="mt-4 p-4 bg-gray-50 rounded-xl border border-gray-100 animate-fadeIn">
                    <p className="text-xs font-bold text-gray-500 mb-2 ml-1">{title}</p>
                    <div className="flex flex-wrap gap-2">
                        {exercises.map((exercise) => (
                            <button key={exercise} type="button" onClick={() => toggleDetail(exercise, exercises)} 
                                className={`py-1.5 px-3 rounded-lg text-xs transition-all border active:scale-95 ${
                                    selectedDetails.includes(exercise) 
                                        ? 'bg-indigo-100 border-indigo-200 text-indigo-700 font-bold' 
                                        : 'bg-white border-gray-200 text-gray-500 hover:bg-gray-100'
                                }`}>
                                {exercise}
                            </button>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans p-4 pb-20 md:p-8">
                    <div className="max-w-md mx-auto space-y-6">
                        
                        <div className="text-center space-y-2 mb-8 pt-4">
                            {/* 추가된 문구 */}
                            <p className="text-xs text-gray-400 font-medium tracking-wide">호야가 사랑으로 만들어준</p>
                            <div className="flex justify-center items-center gap-2 text-indigo-600">
                                <Dumbbell size={32} />
                                <h1 className="text-3xl font-bold tracking-tight">득근 캘린더</h1>
                            </div>
                            <p className="text-gray-500 text-sm">오늘도 꾸준히, 건강한 습관 만들기</p>
                        </div>

                        <div className="bg-white rounded-2xl shadow-sm border border-indigo-100 p-5 flex justify-around items-center">
                            <div className="text-center">
                                <p className="text-xs text-gray-400 mb-1 uppercase tracking-wider font-semibold">총 운동 횟수</p>
                                <p className="text-2xl font-bold text-indigo-600">{totalSessions}회</p>
                            </div>
                            <div className="h-10 w-px bg-gray-100"></div>
                            <div className="text-center">
                                <p className="text-xs text-gray-400 mb-1 uppercase tracking-wider font-semibold">총 운동 시간</p>
                                <p className="text-2xl font-bold text-indigo-600">{formatDuration(totalMinutes)}</p>
                            </div>
                        </div>

                        <form onSubmit={handleSubmit} className="bg-white rounded-2xl shadow-lg p-5 space-y-5 border border-gray-100">
                            <div className="space-y-2">
                                <label className="flex items-center gap-2 text-sm font-semibold text-gray-700">
                                    <Calendar size={16} className="text-indigo-500" /> 날짜
                                </label>
                                <input type="date" required value={date} onChange={(e) => setDate(e.target.value)} className="w-full p-4 text-lg bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all cursor-pointer" />
                            </div>

                            <div className="space-y-2">
                                <label className="flex items-center gap-2 text-sm font-semibold text-gray-700">
                                    <Clock size={16} className="text-indigo-500" /> 운동 시간
                                </label>
                                <div className="grid grid-cols-3 gap-2">
                                    {DURATION_OPTIONS.map((time) => (
                                        <button key={time} type="button" onClick={() => setDuration(time)} className={`py-3 px-1 text-sm rounded-xl border transition-all active:scale-95 ${duration === time ? 'bg-indigo-50 border-indigo-500 text-indigo-700 font-bold' : 'bg-white border-gray-200 text-gray-600'}`}>{formatDuration(time)}</button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-3">
                                <label className="flex items-center gap-2 text-sm font-semibold text-gray-700">
                                    <Activity size={16} className="text-indigo-500" /> 운동 부위
                                </label>
                                <div className="flex flex-wrap gap-2">
                                    {BODY_PARTS.map((part) => (
                                        <button key={part} type="button" onClick={() => toggleBodyPart(part)} className={`py-2 px-4 rounded-full text-sm font-medium transition-all shadow-sm active:scale-95 ${selectedParts.includes(part) ? 'bg-indigo-600 text-white shadow-indigo-200 transform scale-105' : 'bg-gray-100 text-gray-600'}`}>{part}</button>
                                    ))}
                                </div>
                                
                                {/* 상체 세부 항목 */}
                                {selectedParts.includes('상체') && (
                                    <DetailSelector 
                                        partName="상체" 
                                        exercises={UPPER_EXERCISES} 
                                        title="상체 세부 운동 선택 (가슴/등/복합/어깨 순)"
                                    />
                                )}
                                
                                {/* 하체 세부 항목 */}
                                {selectedParts.includes('하체') && (
                                    <DetailSelector 
                                        partName="하체" 
                                        exercises={LOWER_EXERCISES} 
                                        title="하체 세부 운동 선택 (복합/편측/고립 순)"
                                    />
                                )}
                            </div>

                            <button type="submit" className="w-full py-4 bg-indigo-600 text-white font-bold rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2 active:scale-95 text-lg">
                                <Plus size={22} /> 기록 저장하기
                            </button>
                        </form>

                        <div className="space-y-4">
                            <h2 className="text-lg font-bold text-gray-800 px-1 flex items-center gap-2">
                                <CheckCircle2 size={20} className="text-green-500" /> 최근 운동 기록
                            </h2>
                            {workouts.length === 0 ? (
                                <div className="text-center py-10 bg-white rounded-2xl border border-dashed border-gray-300 text-gray-400"><Dumbbell className="mx-auto mb-2 opacity-20" size={48} /><p>아직 기록된 운동이 없습니다.<br/>첫 운동을 시작해보세요!</p></div>
                            ) : (
                                <div className="space-y-3 pb-8">
                                    {workouts.map((workout) => (
                                        <div key={workout.id} className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 relative group">
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="text-sm font-bold text-gray-500 bg-gray-100 px-2 py-0.5 rounded">{workout.date}</span>
                                                <button onClick={() => deleteWorkout(workout.id)} className="text-gray-300 hover:text-red-500 p-2"><Trash2 size={18} /></button>
                                            </div>
                                            <div className="flex flex-col gap-1 mb-2">
                                                <div className="flex items-baseline gap-2 flex-wrap">
                                                    <h3 className="text-2xl font-bold text-gray-800">{formatDuration(workout.duration)}</h3>
                                                    <span className="text-lg font-semibold text-indigo-600">— {workout.parts.join(', ')}</span>
                                                </div>
                                            </div>
                                            {workout.details && workout.details.length > 0 && (
                                                <div className="mt-3 pt-3 border-t border-dashed border-gray-100">
                                                    <div className="flex flex-wrap gap-1.5">
                                                        {workout.details.map((detail, idx) => (
                                                            <span key={idx} className="bg-indigo-50 text-indigo-700 text-xs px-2.5 py-1 rounded-md font-medium flex items-center gap-1"><ChevronRight size={10} />{detail}</span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>